# 露尼西亚AI助手

一个基于PyQt5的桌面AI助手应用，具有天气查询、网站打开、应用管理等功能。

## 🚀 快速开始

### Windows用户（推荐）
1. 确保已安装Python 3.8+
2. 双击 `启动露尼西亚.bat` 文件
3. 等待自动安装依赖包
4. 享受与露尼西亚的对话！

### 其他系统用户
1. 安装Python 3.8+
2. 运行 `pip install -r requirements.txt`
3. 运行 `python main.py`

## 📁 项目文件结构

```
露尼西亚AI助手/
├── 启动露尼西亚.bat          # 完整版启动脚本（推荐首次使用）
├── 快速启动.bat              # 简化版启动脚本（日常使用）
├── main.py                   # 主程序入口
├── config.py                 # 配置文件
├── requirements.txt          # 依赖包列表
├── README.md                 # 项目说明文档
├── ai_agent.py              # AI代理核心模块
├── main_window.py           # 主窗口界面
├── ui_dialogs.py            # 对话框界面
├── memory_lake.py           # 识底深湖记忆系统
├── memory_summary_agent.py  # 记忆总结代理
├── mcp_server.py            # MCP服务器
├── mcp_client.py            # MCP客户端
├── weather_service.py       # 天气服务
├── browser_service.py       # 浏览器服务
├── app_service.py           # 应用管理服务
├── search_service.py        # 搜索服务
├── tts_service.py           # 语音合成服务
├── Lunesia.png              # 露尼西亚半身像
└── 其他配置文件...
```

## 前提条件

在开始使用露尼西亚AI助手之前，请确保您的系统已安装以下软件：

### Python环境

- **Python版本**：Python 3.8 或更高版本
- **推荐版本**：Python 3.9 或 3.10（最佳兼容性）

#### 检查Python版本

```bash
python --version
# 或
python3 --version
```

#### 安装Python

如果您的系统未安装Python，请访问 [Python官网](https://www.python.org/downloads/) 下载并安装：

1. **Windows系统**：
   - 下载Python安装包
   - 运行安装程序，**务必勾选"Add Python to PATH"**
   - 选择"Install Now"进行安装

2. **Linux系统**：
   ```bash
   # Ubuntu/Debian
   sudo apt update
   sudo apt install python3 python3-pip python3-venv
   
   # CentOS/RHEL
   sudo yum install python3 python3-pip
   ```

3. **macOS系统**：
   ```bash
   # 使用Homebrew
   brew install python3
   
   # 或从官网下载安装包
   ```

#### 验证安装

安装完成后，在命令行中运行以下命令验证：

```bash
python --version
pip --version
```

如果显示版本信息，说明Python安装成功。

## 环境配置

### 创建虚拟环境

为了避免依赖冲突，建议使用虚拟环境来运行露尼西亚项目。

#### Windows系统

```bash
# 创建虚拟环境
python -m venv lunesia_env

# 激活虚拟环境
lunesia_env\Scripts\activate

# 验证虚拟环境已激活（命令提示符前会显示 (lunesia_env)）
```

#### Linux/macOS系统

```bash
# 创建虚拟环境
python3 -m venv lunesia_env

# 激活虚拟环境
source lunesia_env/bin/activate

# 验证虚拟环境已激活（命令提示符前会显示 (lunesia_env)）
```

### 虚拟环境管理

```bash
# 退出虚拟环境
deactivate

# 删除虚拟环境（在项目目录外执行）
rm -rf lunesia_env  # Linux/macOS
rmdir /s lunesia_env  # Windows
```

### 虚拟环境优势

- **依赖隔离**：避免与其他Python项目的依赖冲突
- **版本控制**：确保使用特定版本的依赖包
- **环境清理**：可以轻松删除和重建环境
- **部署一致性**：确保开发和生产环境的一致性

## 安装依赖

在激活虚拟环境后安装项目依赖：

```bash
pip install -r requirements.txt
```

## 运行程序

### 方法一：使用启动脚本（推荐）

项目提供了便捷的启动脚本，双击即可运行：

#### Windows系统
- **完整版启动**：双击 `启动露尼西亚.bat`
  - 自动检查Python环境
  - 自动安装依赖包
  - 提供详细的错误诊断
  - 适合首次使用或环境配置

- **快速启动**：双击 `快速启动.bat`
  - 直接启动程序
  - 启动速度更快
  - 适合日常使用

#### 启动脚本特性
- ✅ 支持中文显示（UTF-8编码）
- ✅ 自动检查Python环境
- ✅ 自动安装依赖包
- ✅ 友好的错误提示
- ✅ 异常退出时的诊断信息

### 方法二：命令行启动

在激活虚拟环境后运行程序：

```bash
python main.py
```

#### 首次运行建议
1. 使用 `启动露尼西亚.bat` 进行首次启动
2. 确保所有依赖包正确安装
3. 验证配置文件设置
4. 后续可使用 `快速启动.bat` 进行日常使用

## 主要功能

- **天气查询**：支持和风天气API获取实时天气信息
- **网站浏览**：快速打开常用网站
- **应用管理**：扫描和启动系统应用
- **搜索功能**：使用指定搜索引擎进行网页搜索
- **AI对话**：基于OpenAI/DeepSeek的智能对话
- **记忆系统**：识底深湖智能记忆和上下文回忆
- **MCP工具**：本地工具调用系统，支持文件操作、计算、笔记等

## 配置说明

在设置中可以配置：
- **API密钥**：OpenAI、DeepSeek、和风天气、高德地图
- **天气服务**：和风天气API、高德地图API
- **默认浏览器**：Chrome、Firefox、Edge、Opera、Safari
- **默认搜索引擎**：百度、谷歌、必应、搜狗、360
- **AI模型选择**：DeepSeek-Reasoner、GPT-3.5、GPT-4等
- **TTS设置**：Azure语音服务配置（语音、语速、区域）
- **窗口设置**：透明度、最大token数
- **记忆系统**：识底深湖总结模型、笔记格式
- **网站和应用映射**：自定义网站快捷方式和应用启动

## 使用示例

### 启动程序
- **Windows用户**：双击 `启动露尼西亚.bat` 或 `快速启动.bat`
- **命令行用户**：运行 `python main.py`
- **首次使用**：建议使用完整版启动脚本进行环境检查

### 基础对话
- "你好" - 与露尼西亚打招呼
- "现在几点了" - 获取当前时间
- "今天是什么日子" - 获取当前日期

### 天气查询
- "今天天气怎么样" - 查询当前天气
- "明天会下雨吗" - 查询未来天气
- "北京现在多少度" - 查询特定城市天气

### 网络搜索
- "帮我搜索ChatGPT" - 搜索ChatGPT
- "找一下今天的新闻" - 搜索今日新闻

### 网站浏览
- "打开GitHub" - 使用浏览器打开GitHub
- "打开YouTube" - 打开视频网站

### 应用管理
- "打开记事本" - 启动系统应用
- "运行计算器" - 启动计算器应用

## 识底深湖记忆系统

### 功能特点
- **智能主题总结**：AI自动分析对话内容，提取关键主题
- **自动索引建立**：将主题、时间戳、上下文保存到JSON文件
- **上下文回忆**：当检测到回忆关键词时，自动搜索相关历史对话
- **自然回忆回复**：基于历史上下文生成自然的回忆回复，而非简单复制

### 记忆触发关键词
- "之前"、"记得"、"回忆"、"说过"、"讨论过"、"之前说过"

### 记忆管理
- 点击"识底深湖"按钮查看记忆系统状态
- 支持主题搜索和过滤
- 显示记忆统计信息（总主题数、日志文件数、当前对话数）
- 查看详细的主题索引和上下文摘要

## 本地MCP系统

### 功能特点
- **完全本地化**：所有MCP工具都在本地运行，无需网络连接
- **丰富工具集**：提供系统信息、文件操作、命令执行、笔记管理等多种工具
- **可视化管理**：通过MCP工具窗口管理所有可用工具
- **智能调用**：露尼西亚可以智能识别并调用相应的MCP工具

### 可用工具
- **系统工具**：`get_system_info` - 获取系统信息
- **文件操作**：`list_files`, `read_file`, `write_file`, `create_folder` - 文件管理
- **命令执行**：`execute_command`, `get_process_list` - 系统命令
- **笔记管理**：`create_note`, `list_notes`, `search_notes` - 笔记功能
- **计算工具**：`calculate` - 数学计算
- **天气信息**：`get_weather_info` - 实时天气查询（和风天气API）
- **记忆统计**：`get_memory_stats` - 记忆系统统计

### 使用方法
- **直接调用**：`执行 get_system_info` 或 `调用 list_files directory=.`
- **参数传递**：`执行 create_note title=测试 content=内容`
- **查看工具**：`工具列表` 或 `有哪些工具`
- **管理界面**：点击"MCP工具"按钮打开管理窗口
- **自定义工具**：通过管理界面创建、编辑、删除自定义工具
- **智能调用**：露尼西亚会自动判断并调用相应的MCP工具

### 使用示例

#### 笔记管理
```
指挥官：讲一下MCP工具
露尼西亚：介绍了MCP工具
指挥官: 帮我保存文件
露尼西亚: 文件 D:/露尼西亚文件/文档.txt 写入成功

#### 计算工具
```
指挥官: 计算 (15 + 27) * 3 - 8
露尼西亚: 🧮 计算结果：(15 + 27) * 3 - 8 = 118

指挥官: 计算复利：本金10000，年利率5%，存3年
露尼西亚: 💰 复利计算结果：
📊 本金：10,000元
📈 年利率：5%
⏰ 存期：3年
💵 最终金额：11,576.25元
📈 总收益：1,576.25元
```

#### 距离计算
```
指挥官: 上海到深圳有多远
露尼西亚: 🗺️ 距离计算结果：
📍 起点：上海市
📍 终点：深圳市
📏 直线距离：1,212.5公里
🚗 驾车距离：约1,450公里
✈️ 飞行时间：约2小时15分钟
```

#### 天气查询
```
指挥官: 今天上海天气怎么样
露尼西亚: 🌤️ 上海天气信息：
🌡️ 当前温度：18°C
🌡️ 体感温度：16°C
🌤️ 天气状况：多云转晴
💨 风向：西北风
💨 风力：3级
💧 湿度：72%
👁️ 能见度：12km
🌧️ 降雨概率：10%
⏰ 更新时间：2024-12-19 14:30:00
```

#### 工具管理
```
指挥官: 显示所有可用工具
露尼西亚: 🛠️ 可用工具列表：
📊 系统工具：get_system_info, get_process_list
📁 文件操作：list_files, read_file, write_file, create_folder
📝 笔记管理：create_note, list_notes, search_notes
🧮 计算工具：calculate
🌤️ 天气查询：get_weather_info
📈 记忆统计：get_memory_stats
🗺️ 自定义工具：calculate_distance
```

### 技术架构
- **MCP服务器**：`mcp_server.py` - 提供工具服务
- **MCP客户端**：`mcp_client.py` - 本地客户端实现
- **工具管理**：集成在主程序中的可视化管理界面
- **自定义工具**：支持用户创建和管理自定义Python工具
- **工具类型**：区分内置工具和自定义工具，内置工具不可编辑/删除

### 自定义工具开发
- **创建方式**：通过MCP工具管理界面的"新建工具"按钮
- **代码格式**：Python函数，支持参数传递
- **存储位置**：`custom_tools.json` 文件
- **动态加载**：支持运行时重新加载自定义工具
- **安全执行**：在隔离的命名空间中执行自定义代码
- **API密钥管理**：支持快速替换代码中的"mykey"占位符为实际API密钥



